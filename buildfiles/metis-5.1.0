# vim: set ft=sh:
pkgname=metis
pkgver=5.1.0
pkgurl=http://glaros.dtc.umn.edu/gkhome/fetch/sw/metis/metis-${pkgver}.tar.gz

module load cmake

configure()
{
  pushd $tmpdir/$srcdir
  make config shared=1 prefix=$destdir
  popd
}

build()
{
  pushd $tmpdir/$srcdir
  make
  popd
}

package()
{
  # remove old installation
  [ -d $destdir ] && rm -rfv $destdir
  # install new one
  pushd $tmpdir/$srcdir
  make install
  popd
}

post_package()
{
  pushd $destdir/lib
  install_name_tool -id $destdir/lib/libmetis.dylib libmetis.dylib
  popd
}

pkgmodule=$(cat <<-EOT
#%Module
set METIS_DIR $REPO/opt/metis-$pkgver
setenv METIS_DIR \$METIS_DIR

prepend-path PATH \$METIS_DIR/bin
EOT)
