# vim: set ft=sh:
pkgurl=https://github.com/ospray/OSPRay/archive/v${pkgver}.tar.gz
srcdir=OSPRay-${pkgver}

module load embree
moduledeps+=("embree")
export USE_CMAKE=1
export embree_DIR=$EMBREE_DIR

confopts=$(cat <<END_HEREDOC
-DOSPRAY_APPS_QTVIEWER:BOOL=OFF
-DOSPRAY_APPS_VOLUMEVIEWER:BOOL=OFF
-DOSPRAY_BUILD_MIC_SUPPORT:BOOL=OFF
-DOSPRAY_USE_EXTERNAL_EMBREE:BOOL=ON
END_HEREDOC
)

apply_patch()
{
  patch -Np0 < $REPO/buildfiles/ospray_cmake37.patch
#  patch -Np1 < $REPO/buildfiles/ospray_cos_gcc61.patch
#  patch -Np0 < $REPO/buildfiles/ospray_tbb_2017.patch
}

post_package()
{
  pushd $destdir
  rm lib64/libtbb.so.2
  rm lib64/libtbbmalloc.so.2
  popd
}

