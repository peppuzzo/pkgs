# vim: set ft=sh:
pkgname=parmetis
pkgver=4.0.3
pkgurl=http://glaros.dtc.umn.edu/gkhome/fetch/sw/parmetis/parmetis-${pkgver}.tar.gz

module load cmake openmpi

configure()
{
  pushd $tmpdir/$srcdir
  make config shared=1 prefix=$destdir
  popd
}

build()
{
  pushd $tmpdir/$srcdir
  make
  popd
}

package()
{
  # remove old installation
  [ -d $destdir ] && rm -rfv $destdir
  # install new one
  pushd $tmpdir/$srcdir
  make install
  popd
}

post_package()
{
  pushd $destdir/lib
  install_name_tool -id $destdir/lib/libparmetis.dylib libparmetis.dylib
  popd
}

pkgmodule=$(cat <<-EOT
#%Module
set PARMETIS_DIR $REPO/opt/parmetis-$pkgver
setenv PARMETIS_DIR \$PARMETIS_DIR

prepend-path PATH \$PARMETIS_DIR/bin
EOT)
